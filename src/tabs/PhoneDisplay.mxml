<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
				xmlns:vo="vo.*"
				minWidth="955" minHeight="600"
				initialize="application1_initializeHandler(event)">
	<mx:Script>
		
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			
			import vo.CategoryVO;
			import vo.ProductVO;
			
			private const DP_DATA_URL:String = "http://digitalprimates.net/flexstore/data/catalog.xml";
			
			private const NOKIA_3000:String = "Nokia 3000";
			private const NOKIA_6000:String = "Nokia 6000";
			private const NOKIA_7000:String = "Nokia 7000";
			private const NOKIA_9000:String = "Nokia 9000";
			
			[Bindable]
			private var products:Array;
			
			[Bindable]
			public var phoneCategories:ArrayCollection;
			
			private var xmlLoader:URLLoader;
			private var catalogXML:XML;
			
			//-------------------------------------------------------------------
			
			private function filter3( product:ProductVO ):Boolean 
			{
				return ( product.series.toString() == "3000" );
			}
			
			private function filter6( product:ProductVO ):Boolean 
			{
				return ( product.series.toString() == "6000" );
			}
			
			private function filter7( product:ProductVO ):Boolean 
			{
				return ( product.series.toString() == "7000" );
			}
			
			private function filter9( product:ProductVO ):Boolean 
			{
				return ( product.series.toString() == "9000" );
			}
			
			//-------------------------------------------------------------------
			
			private function sortProductsByCategory( productsCollection:ArrayCollection, filter:Function ):void
			{
				productsCollection.filterFunction = filter;
				productsCollection.refresh();
			}
			
			//-------------------------------------------------------------------
			
			private function sortProducts( products:Array ):void
			{
				var products3Collection:ArrayCollection = new ArrayCollection( products );
				var products6Collection:ArrayCollection = new ArrayCollection( products );
				var products7Collection:ArrayCollection = new ArrayCollection( products );
				var products9Collection:ArrayCollection = new ArrayCollection( products );
				
				sortProductsByCategory( products3Collection, filter3 );
				sortProductsByCategory( products6Collection, filter6 );
				sortProductsByCategory( products7Collection, filter7 );
				sortProductsByCategory( products9Collection, filter9 );
				
				var filtered3Category:CategoryVO = new CategoryVO( NOKIA_3000, products3Collection );
				var filtered6Category:CategoryVO = new CategoryVO( NOKIA_6000, products6Collection );
				var filtered7Category:CategoryVO = new CategoryVO( NOKIA_7000, products7Collection );
				var filtered9Category:CategoryVO = new CategoryVO( NOKIA_9000, products9Collection );
				
				phoneCategories = new ArrayCollection();
				
				phoneCategories.addItem( filtered3Category ); 
				phoneCategories.addItem( filtered6Category ); 
				phoneCategories.addItem( filtered7Category ); 
				phoneCategories.addItem( filtered9Category ); 
			}
			
			private function parseXML( catalogXML:XML ):Array 
			{
				products = new Array();
				
				for each( var productXML:XML in catalogXML.product ) 
				{
					var productId:int = productXML[0].@productId;
					var name:String = productXML[0].name;
					var description:String = productXML[0].description;
					var price:Number = productXML[0].price;
					var image:String = productXML[0].image;
					var series:int = productXML[0].series;
					var triband:Boolean = productXML[0].triband;
					var camera:Boolean = productXML[0].camera;
					var video:Boolean = productXML[0].video;
					var highlight1:String = productXML[0].highlight1;
					var highlight2:String = productXML[0].highlight2;
					
					var product:ProductVO = new ProductVO( productId, name, description, price, image, series, triband, camera, video, highlight1, highlight2 );
					
					products.push(product);
				}
				
				return products;
			}
			
			private function handle_xmlLoaderComplete(e:Event):void 
			{
				catalogXML = XML(e.target.data);
				products = new Array();
				products = parseXML(catalogXML);
				
				sortProducts(products);
				
				gc.refresh();
			}
			
			protected function application1_initializeHandler(event:FlexEvent):void
			{
				xmlLoader = new URLLoader();
				xmlLoader.addEventListener(Event.COMPLETE, handle_xmlLoaderComplete);
				xmlLoader.load(new URLRequest(DP_DATA_URL));
			}
		]]>
		
	</mx:Script>
	
	<mx:HBox>
		
		<mx:Tree id="myTree" 
				 width="180" 
				 height="100%" 
				 dataProvider="{phoneCategories}"
				 labelField="name"
				 />
		
		<mx:AdvancedDataGrid
			id="eventsGrid"
			height="650"
			>
			
			<mx:dataProvider>
				<mx:GroupingCollection id="gc" source="{products}" >
					<mx:grouping>
						<mx:Grouping>
							<mx:GroupingField name="series"/>
						</mx:Grouping>
					</mx:grouping>
				</mx:GroupingCollection>
			</mx:dataProvider>
			
			
			<mx:columns>
				<mx:AdvancedDataGridColumn
					headerText="Name"
					dataField="name"
					width="150"
					wordWrap="true"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Description"
					width="200"
					wordWrap="true"
					textAlign="center"
					dataField="description"
					/>
				
				<mx:AdvancedDataGridColumn 
					headerText="Price"
					textAlign="center"
					dataField="price"
					wordWrap="true"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Image"
					textAlign="center"
					dataField="image"
					wordWrap="true"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Series"
					textAlign="center"
					dataField="series"
					wordWrap="true"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Triband"
					textAlign="center"
					dataField="triband"
					/>
				
				<mx:AdvancedDataGridColumn 
					headerText="Camera"
					textAlign="center"
					dataField="camera"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Video"
					textAlign="center"
					dataField="video"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Highlight1"
					textAlign="center"
					dataField="highlight1"
					wordWrap="true"
					/>
				
				<mx:AdvancedDataGridColumn
					headerText="Highlight2"
					textAlign="center"
					dataField="highlight2"
					wordWrap="true"
					/>
				
			</mx:columns>
		</mx:AdvancedDataGrid>
	</mx:HBox>
</mx:Canvas>
